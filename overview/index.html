<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Demystifying inner-workings of Spark Standalone"><meta name=author content="Jacek Laskowski"><link href=https://books.japila.pl/spark-standalone-internals/overview/ rel=canonical><link rel=icon href=../assets/images/favicon.png><meta name=generator content="mkdocs-1.2.3, mkdocs-material-7.3.6+insiders-3.2.0"><title>Overview - The Internals of Spark Standalone</title><link rel=stylesheet href=../assets/stylesheets/main.f60820f2.min.css><link rel=stylesheet href=../assets/stylesheets/palette.1d832a92.min.css><link rel=preload as=style href=../assets/stylesheets/vendor/mermaid.733f213f.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style><script>function __md_scope(e,t,_){return new URL(_||(t===localStorage?"..":".."),location).pathname+"."+e}function __md_get(e,t=localStorage,_){return JSON.parse(t.getItem(__md_scope(e,t,_)))}function __md_set(e,t,_=localStorage,o){try{_.setItem(__md_scope(e,_,o),JSON.stringify(t))}catch(e){}}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#spark-standalone class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=.. title="The Internals of Spark Standalone" class="md-header__button md-logo" aria-label="The Internals of Spark Standalone" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m19 2-5 4.5v11l5-4.5V2M6.5 5C4.55 5 2.45 5.4 1 6.5v14.66c0 .25.25.5.5.5.1 0 .15-.07.25-.07 1.35-.65 3.3-1.09 4.75-1.09 1.95 0 4.05.4 5.5 1.5 1.35-.85 3.8-1.5 5.5-1.5 1.65 0 3.35.31 4.75 1.06.1.05.15.03.25.03.25 0 .5-.25.5-.5V6.5c-.6-.45-1.25-.75-2-1V19c-1.1-.35-2.3-.5-3.5-.5-1.7 0-4.15.65-5.5 1.5V6.5C10.55 5.4 8.45 5 6.5 5z"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> The Internals of Spark Standalone </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Overview </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=blue data-md-color-accent=blue aria-label="Switch to light mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08z"/></svg> </a> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/japila-books/spark-standalone-internals/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> spark-standalone-internals </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=./ class="md-tabs__link md-tabs__link--active"> Internals </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=.. title="The Internals of Spark Standalone" class="md-nav__button md-logo" aria-label="The Internals of Spark Standalone" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m19 2-5 4.5v11l5-4.5V2M6.5 5C4.55 5 2.45 5.4 1 6.5v14.66c0 .25.25.5.5.5.1 0 .15-.07.25-.07 1.35-.65 3.3-1.09 4.75-1.09 1.95 0 4.05.4 5.5 1.5 1.35-.85 3.8-1.5 5.5-1.5 1.65 0 3.35.31 4.75 1.06.1.05.15.03.25.03.25 0 .5-.25.5-.5V6.5c-.6-.45-1.25-.75-2-1V19c-1.1-.35-2.3-.5-3.5-.5-1.7 0-4.15.65-5.5 1.5V6.5C10.55 5.4 8.45 5 6.5 5z"/></svg> </a> The Internals of Spark Standalone </label> <div class=md-nav__source> <a href=https://github.com/japila-books/spark-standalone-internals/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> spark-standalone-internals </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. class=md-nav__link> Home </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 type=checkbox id=__nav_2 checked> <label class=md-nav__link for=__nav_2> Internals <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Internals data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Internals </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Overview <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Overview </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#round-robin-scheduling-across-nodes class=md-nav__link> Round-robin Scheduling Across Nodes </a> <nav class=md-nav aria-label="Round-robin Scheduling Across Nodes"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#scheduleexecutorsonworkers class=md-nav__link> scheduleExecutorsOnWorkers </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#spark_worker_instances-and-spark_worker_cores class=md-nav__link> SPARK_WORKER_INSTANCES (and SPARK_WORKER_CORES) </a> </li> <li class=md-nav__item> <a href=#multiple-executors-per-worker-in-standalone-mode class=md-nav__link> Multiple executors per worker in Standalone mode </a> </li> <li class=md-nav__item> <a href=#sparkdeployschedulerbackend class=md-nav__link> SparkDeploySchedulerBackend </a> </li> <li class=md-nav__item> <a href=#appclient class=md-nav__link> AppClient </a> </li> <li class=md-nav__item> <a href=#initialization-appclientstart-method class=md-nav__link> Initialization - AppClient.start() method </a> <nav class=md-nav aria-label="Initialization - AppClient.start() method"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#appclient-rpc-endpoint class=md-nav__link> AppClient RPC Endpoint </a> <nav class=md-nav aria-label="AppClient RPC Endpoint"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#registerapplication-rpc-message class=md-nav__link> RegisterApplication RPC message </a> </li> <li class=md-nav__item> <a href=#registeredapplication-rpc-message class=md-nav__link> RegisteredApplication RPC message </a> </li> <li class=md-nav__item> <a href=#applicationremoved-rpc-message class=md-nav__link> ApplicationRemoved RPC message </a> </li> <li class=md-nav__item> <a href=#executoradded-rpc-message class=md-nav__link> ExecutorAdded RPC message </a> </li> <li class=md-nav__item> <a href=#executorupdated-rpc-message class=md-nav__link> ExecutorUpdated RPC message </a> </li> <li class=md-nav__item> <a href=#masterchanged-rpc-message class=md-nav__link> MasterChanged RPC message </a> </li> <li class=md-nav__item> <a href=#stopappclient-rpc-message class=md-nav__link> StopAppClient RPC message </a> </li> <li class=md-nav__item> <a href=#requestexecutors-rpc-message class=md-nav__link> RequestExecutors RPC message </a> </li> <li class=md-nav__item> <a href=#killexecutors-rpc-message class=md-nav__link> KillExecutors RPC message </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../configuration-properties/ class=md-nav__link> Configuration Properties </a> </li> <li class=md-nav__item> <a href=../ClientApp/ class=md-nav__link> ClientApp </a> </li> <li class=md-nav__item> <a href=../ClientEndpoint/ class=md-nav__link> ClientEndpoint </a> </li> <li class=md-nav__item> <a href=../CreateSubmissionRequest/ class=md-nav__link> CreateSubmissionRequest </a> </li> <li class=md-nav__item> <a href=../ExecutorRunner/ class=md-nav__link> ExecutorRunner </a> </li> <li class=md-nav__item> <a href=../LocalSparkCluster/ class=md-nav__link> LocalSparkCluster </a> </li> <li class=md-nav__item> <a href=../Master/ class=md-nav__link> Master </a> </li> <li class=md-nav__item> <a href=../RestSubmissionClient/ class=md-nav__link> RestSubmissionClient </a> </li> <li class=md-nav__item> <a href=../RestSubmissionServer/ class=md-nav__link> RestSubmissionServer </a> </li> <li class=md-nav__item> <a href=../StandaloneAppClient/ class=md-nav__link> StandaloneAppClient </a> </li> <li class=md-nav__item> <a href=../StandaloneAppClientListener/ class=md-nav__link> StandaloneAppClientListener </a> </li> <li class=md-nav__item> <a href=../StandaloneRestServer/ class=md-nav__link> StandaloneRestServer </a> </li> <li class=md-nav__item> <a href=../StandaloneSchedulerBackend/ class=md-nav__link> StandaloneSchedulerBackend </a> </li> <li class=md-nav__item> <a href=../Worker/ class=md-nav__link> Worker </a> </li> <li class=md-nav__item> <a href=../logging/ class=md-nav__link> Logging </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#round-robin-scheduling-across-nodes class=md-nav__link> Round-robin Scheduling Across Nodes </a> <nav class=md-nav aria-label="Round-robin Scheduling Across Nodes"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#scheduleexecutorsonworkers class=md-nav__link> scheduleExecutorsOnWorkers </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#spark_worker_instances-and-spark_worker_cores class=md-nav__link> SPARK_WORKER_INSTANCES (and SPARK_WORKER_CORES) </a> </li> <li class=md-nav__item> <a href=#multiple-executors-per-worker-in-standalone-mode class=md-nav__link> Multiple executors per worker in Standalone mode </a> </li> <li class=md-nav__item> <a href=#sparkdeployschedulerbackend class=md-nav__link> SparkDeploySchedulerBackend </a> </li> <li class=md-nav__item> <a href=#appclient class=md-nav__link> AppClient </a> </li> <li class=md-nav__item> <a href=#initialization-appclientstart-method class=md-nav__link> Initialization - AppClient.start() method </a> <nav class=md-nav aria-label="Initialization - AppClient.start() method"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#appclient-rpc-endpoint class=md-nav__link> AppClient RPC Endpoint </a> <nav class=md-nav aria-label="AppClient RPC Endpoint"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#registerapplication-rpc-message class=md-nav__link> RegisterApplication RPC message </a> </li> <li class=md-nav__item> <a href=#registeredapplication-rpc-message class=md-nav__link> RegisteredApplication RPC message </a> </li> <li class=md-nav__item> <a href=#applicationremoved-rpc-message class=md-nav__link> ApplicationRemoved RPC message </a> </li> <li class=md-nav__item> <a href=#executoradded-rpc-message class=md-nav__link> ExecutorAdded RPC message </a> </li> <li class=md-nav__item> <a href=#executorupdated-rpc-message class=md-nav__link> ExecutorUpdated RPC message </a> </li> <li class=md-nav__item> <a href=#masterchanged-rpc-message class=md-nav__link> MasterChanged RPC message </a> </li> <li class=md-nav__item> <a href=#stopappclient-rpc-message class=md-nav__link> StopAppClient RPC message </a> </li> <li class=md-nav__item> <a href=#requestexecutors-rpc-message class=md-nav__link> RequestExecutors RPC message </a> </li> <li class=md-nav__item> <a href=#killexecutors-rpc-message class=md-nav__link> KillExecutors RPC message </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/japila-books/spark-standalone-internals/edit/main/docs/overview.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg> </a> <h1 id=spark-standalone>Spark Standalone<a class=headerlink href=#spark-standalone title="Permanent link">&para;</a></h1> <p><strong>Spark Standalone</strong> (<em>Standalone Cluster</em>) is Spark's own built-in cluster environment. Since Spark Standalone is available in the default distribution of Apache Spark it is the easiest way to run your Spark applications in a clustered environment in many cases.</p> <p><a href=../Master/ >Standalone Master</a> (<em>standalone Master</em>) is the resource manager for the Spark Standalone cluster.</p> <p><a href=../Worker/ >Standalone Worker</a> is a worker in a Spark Standalone cluster. There can be one or many workers in a standalone cluster.</p> <p>In Standalone cluster mode Spark allocates resources based on cores. By default, an application will grab all the cores in the cluster.</p> <p>Standalone cluster mode is subject to the constraint that only one executor can be allocated on each worker per application.</p> <p>A Spark Standalone cluster is available using <code>spark://</code>-prefixed master URL.</p> <h2 id=round-robin-scheduling-across-nodes>Round-robin Scheduling Across Nodes<a class=headerlink href=#round-robin-scheduling-across-nodes title="Permanent link">&para;</a></h2> <p>If enabled (using <a href=../configuration-properties/#spark.deploy.spreadOut>spark.deploy.spreadOut</a>), standalone Master attempts to spread out an application's executors on as many workers as possible (instead of trying to consolidate it onto a small number of nodes).</p> <h3 id=scheduleexecutorsonworkers>scheduleExecutorsOnWorkers<a class=headerlink href=#scheduleexecutorsonworkers title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><span class=n>scheduleExecutorsOnWorkers</span><span class=p>(</span>
  <span class=n>app</span><span class=p>:</span> <span class=nc>ApplicationInfo</span><span class=p>,</span>
  <span class=n>usableWorkers</span><span class=p>:</span> <span class=nc>Array</span><span class=p>[</span><span class=nc>WorkerInfo</span><span class=p>],</span>
  <span class=n>spreadOutApps</span><span class=p>:</span> <span class=nc>Boolean</span><span class=p>):</span> <span class=nc>Array</span><span class=p>[</span><span class=nc>Int</span><span class=p>]</span>
</code></pre></div> <p><code>scheduleExecutorsOnWorkers</code> schedules executors on workers.</p> <h2 id=spark_worker_instances-and-spark_worker_cores>SPARK_WORKER_INSTANCES (and SPARK_WORKER_CORES)<a class=headerlink href=#spark_worker_instances-and-spark_worker_cores title="Permanent link">&para;</a></h2> <p>There is really no need to run multiple workers per machine in Spark 1.5 (perhaps in 1.4, too). You can run multiple executors on the same machine with one worker.</p> <p>Use <code>SPARK_WORKER_INSTANCES</code> (default: <code>1</code>) in <code>spark-env.sh</code> to define the number of worker instances.</p> <p>If you use <code>SPARK_WORKER_INSTANCES</code>, make sure to set <code>SPARK_WORKER_CORES</code> explicitly to limit the cores per worker, or else each worker will try to use all the cores.</p> <p>You can set up the number of cores as an command line argument when you start a worker daemon using <code>--cores</code>.</p> <h2 id=multiple-executors-per-worker-in-standalone-mode>Multiple executors per worker in Standalone mode<a class=headerlink href=#multiple-executors-per-worker-in-standalone-mode title="Permanent link">&para;</a></h2> <p>CAUTION: It can be a duplicate of the above section.</p> <p>It is possible to start multiple executors in a single JVM process of a worker.</p> <p>To launch multiple executors on a machine you start multiple standalone workers, each with its own JVM. It introduces unnecessary overhead due to these JVM processes, provided that there are enough cores on that worker.</p> <p>If you are running Spark in standalone mode on memory-rich nodes it can be beneficial to have multiple worker instances on the same node as a very large heap size has two disadvantages:</p> <ul> <li>Garbage collector pauses can hurt throughput of Spark jobs.</li> <li>Heap size of &gt;32 GB can’t use CompressedOoops. So <a href=https://blog.codecentric.de/en/2014/02/35gb-heap-less-32gb-java-jvm-memory-oddities/ >35 GB is actually less than 32 GB</a>.</li> </ul> <p>Mesos and YARN can, out of the box, support packing multiple, smaller executors onto the same physical host, so requesting smaller executors doesn’t mean your application will have fewer overall resources.</p> <h2 id=sparkdeployschedulerbackend>SparkDeploySchedulerBackend<a class=headerlink href=#sparkdeployschedulerbackend title="Permanent link">&para;</a></h2> <p><code>SparkDeploySchedulerBackend</code> is the xref:scheduler:SchedulerBackend.md[Scheduler Backend] for Spark Standalone, i.e. it is used when you xref:ROOT:SparkContext.md#creating-instance[create a SparkContext] using <code>spark://</code> master URL.</p> <p>It is a specialized xref:scheduler:CoarseGrainedSchedulerBackend.md[CoarseGrainedSchedulerBackend] that uses &lt;<appclient, appclient>&gt; and is a <code>AppClientListener</code>.</p> <p>.SparkDeploySchedulerBackend.start() (while SparkContext starts) image::SparkDeploySchedulerBackend-AppClient-start.png[align="center"]</p> <p>CAUTION: FIXME <code>AppClientListener</code> &amp; <code>ApplicationDescription</code></p> <p>It uses &lt;<appclient, appclient>&gt; to talk to executors.</p> <h2 id=appclient>AppClient<a class=headerlink href=#appclient title="Permanent link">&para;</a></h2> <p><code>AppClient</code> is an interface to allow Spark applications to talk to a Standalone cluster (using a RPC Environment). It takes an RPC Environment, a collection of master URLs, a <code>ApplicationDescription</code>, and a <code>AppClientListener</code>.</p> <p>It is solely used by &lt;<sparkdeployschedulerbackend, sparkdeployschedulerbackend>&gt;.</p> <p><code>AppClient</code> registers <em>AppClient</em> RPC endpoint (using <code>ClientEndpoint</code> class) to a given RPC Environment.</p> <p><code>AppClient</code> uses a daemon cached thread pool (<code>askAndReplyThreadPool</code>) with threads' name in the format of <code>appclient-receive-and-reply-threadpool-ID</code>, where <code>ID</code> is a unique integer for asynchronous asks and replies. It is used for requesting executors (via <code>RequestExecutors</code> message) and kill executors (via <code>KillExecutors</code>).</p> <p><code>sendToMaster</code> sends one-way <code>ExecutorStateChanged</code> and <code>UnregisterApplication</code> messages to master.</p> <h2 id=initialization-appclientstart-method>Initialization - AppClient.start() method<a class=headerlink href=#initialization-appclientstart-method title="Permanent link">&para;</a></h2> <p>When AppClient starts, <code>AppClient.start()</code> method is called that merely registers &lt;<appclient-rpc-endpoint, appclient rpc endpoint>&gt;.</p> <h3 id=appclient-rpc-endpoint>AppClient RPC Endpoint<a class=headerlink href=#appclient-rpc-endpoint title="Permanent link">&para;</a></h3> <p><em>AppClient</em> RPC endpoint is started as part of &lt;<appclient-initialization, appclient&#x27;s initialization>&gt; (that is in turn part of &lt;<sparkdeployschedulerbackend, sparkdeployschedulerbackend&#x27;s initialization, i.e. the scheduler backend for spark standalone>&gt;).</p> <p>It is a <code>ThreadSafeRpcEndpoint</code> that knows about the RPC endpoint of the primary active standalone Master (there can be a couple of them, but only one can be active and hence primary).</p> <p>When it starts, it sends &lt;<registerapplication, registerapplication>&gt; message to register an application and itself.</p> <h4 id=registerapplication-rpc-message>RegisterApplication RPC message<a class=headerlink href=#registerapplication-rpc-message title="Permanent link">&para;</a></h4> <p>An AppClient registers the Spark application to a single master (regardless of the number of the standalone masters given in the master URL).</p> <p><img alt="AppClient registers application to standalone Master" src=../images/appclient-registerapplication.png></p> <p>It uses a dedicated thread pool <em>appclient-register-master-threadpool</em> to asynchronously send <code>RegisterApplication</code> messages, one per standalone master.</p> <div class=highlight><pre><span></span><code>Connecting to master spark://localhost:7077...
</code></pre></div> <p>An AppClient tries connecting to a standalone master 3 times every 20 seconds per master before giving up. They are not configurable parameters.</p> <p>The appclient-register-master-threadpool thread pool is used until the registration is finished, i.e. AppClient is connected to the primary standalone Master or the registration fails. It is then <code>shutdown</code>.</p> <h4 id=registeredapplication-rpc-message>RegisteredApplication RPC message<a class=headerlink href=#registeredapplication-rpc-message title="Permanent link">&para;</a></h4> <p><code>RegisteredApplication</code> is a one-way message from the primary master to confirm successful application registration. It comes with the application id and the master's RPC endpoint reference.</p> <p>The <code>AppClientListener</code> gets notified about the event via <code>listener.connected(appId)</code> with <code>appId</code> being an application id.</p> <h4 id=applicationremoved-rpc-message>ApplicationRemoved RPC message<a class=headerlink href=#applicationremoved-rpc-message title="Permanent link">&para;</a></h4> <p><code>ApplicationRemoved</code> is received from the primary master to inform about having removed the application. AppClient RPC endpoint is stopped afterwards.</p> <p>It can come from the standalone Master after a kill request from Web UI, application has finished properly or the executor where the application was still running on has been killed, failed, lost or exited.</p> <h4 id=executoradded-rpc-message>ExecutorAdded RPC message<a class=headerlink href=#executoradded-rpc-message title="Permanent link">&para;</a></h4> <p><code>ExecutorAdded</code> is received from the primary master to inform about...FIXME</p> <p>CAUTION: FIXME the message</p> <div class=highlight><pre><span></span><code>Executor added: %s on %s (%s) with %d cores
</code></pre></div> <h4 id=executorupdated-rpc-message>ExecutorUpdated RPC message<a class=headerlink href=#executorupdated-rpc-message title="Permanent link">&para;</a></h4> <p><code>ExecutorUpdated</code> is received from the primary master to inform about...FIXME</p> <p>CAUTION: FIXME the message</p> <div class=highlight><pre><span></span><code>Executor updated: %s is now %s%s
</code></pre></div> <h4 id=masterchanged-rpc-message>MasterChanged RPC message<a class=headerlink href=#masterchanged-rpc-message title="Permanent link">&para;</a></h4> <p><code>MasterChanged</code> is received from the primary master to inform about...FIXME</p> <p>CAUTION: FIXME the message</p> <div class=highlight><pre><span></span><code>Master has changed, new master is at
</code></pre></div> <h4 id=stopappclient-rpc-message>StopAppClient RPC message<a class=headerlink href=#stopappclient-rpc-message title="Permanent link">&para;</a></h4> <p><code>StopAppClient</code> is a reply-response message from the SparkDeploySchedulerBackend to stop the AppClient after the SparkContext has been stopped (and so should the running application on the standalone cluster).</p> <p>It stops the AppClient RPC endpoint.</p> <h4 id=requestexecutors-rpc-message>RequestExecutors RPC message<a class=headerlink href=#requestexecutors-rpc-message title="Permanent link">&para;</a></h4> <p><code>RequestExecutors</code> is a reply-response message from the SparkDeploySchedulerBackend that is passed on to the master to request executors for the application.</p> <h4 id=killexecutors-rpc-message>KillExecutors RPC message<a class=headerlink href=#killexecutors-rpc-message title="Permanent link">&para;</a></h4> <p><code>KillExecutors</code> is a reply-response message from the SparkDeploySchedulerBackend that is passed on to the master to kill executors assigned to the application.</p> </article> </div> </div> <a href=# class="md-top md-icon" data-md-component=top data-md-state=hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg> Back to top </a> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=.. class="md-footer__link md-footer__link--prev" aria-label="Previous: Home" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> Home </div> </div> </a> <a href=../configuration-properties/ class="md-footer__link md-footer__link--next" aria-label="Next: Configuration Properties" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> Configuration Properties </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> Copyright &copy; 2021 Jacek Laskowski </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs Insiders </a> </div> <div class=md-footer-social> <a href=https://github.com/jaceklaskowski target=_blank rel=noopener title=github.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> <a href=https://twitter.com/jaceklaskowski target=_blank rel=noopener title=twitter.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg> </a> <a href=https://linkedin.com/in/jaceklaskowski target=_blank rel=noopener title=linkedin.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg> </a> <a href=https://jaceklaskowski.medium.com target=_blank rel=noopener title=jaceklaskowski.medium.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M0 32v448h448V32H0zm372.2 106.1-24 23c-2.1 1.6-3.1 4.2-2.7 6.7v169.3c-.4 2.6.6 5.2 2.7 6.7l23.5 23v5.1h-118V367l24.3-23.6c2.4-2.4 2.4-3.1 2.4-6.7V199.8l-67.6 171.6h-9.1L125 199.8v115c-.7 4.8 1 9.7 4.4 13.2l31.6 38.3v5.1H71.2v-5.1l31.6-38.3c3.4-3.5 4.9-8.4 4.1-13.2v-133c.4-3.7-1-7.3-3.8-9.8L75 138.1V133h87.3l67.4 148L289 133.1h83.2v5z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "..", "features": ["content.code.annotate", "navigation.indexes", "navigation.instant", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.d5944110.min.js", "version": null}</script> <script src=../assets/javascripts/bundle.4b1ed6f7.min.js></script> </body> </html>